# Changelog v2
# Generated by Claude AI

All notable changes to the Slack Channel Export Tool will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [2.1.1] - 2025-10-22

### Fixed
- **Filename Sanitization**: Fixed crash when downloading files with invalid Windows characters (colons, etc.) in filenames
  - Example: `Video clip (2025-08-05 13:55:16).mov` now saves as `Video clip (2025-08-05 13_55_16).mov`
  - Handles all invalid Windows characters: `< > : " / \ | ? *`
  - Achieved 100% file download success rate

## [2.1.0] - 2025-10-22

### Added
- **Timestamped Export Folders**: Each export now creates its own timestamped folder
  - Format: `Output/YYYY-MM-DD-HHMM/`
  - All files (exports, logs, attachments) grouped together
  - Prevents file conflicts between multiple export runs
  - Makes archival and organization much easier

- **IP Address Anonymization** (Optional Feature): 
  - Replaces public IP addresses with `[IP-REDACTED]`
  - Preserves private IPs (10.x, 192.168.x, 172.16-31.x)
  - Preserves localhost (127.x) and common DNS servers
  - Perfect for sharing TAK configs publicly
  - Enable with `"anonymize_ips": true` in config.json

- **Config File Support**: 
  - Load settings from `config.json` instead of hardcoding
  - Script looks for config in same directory as script (not working directory)
  - Falls back to defaults if config not found
  - Includes helpful error messages for invalid tokens

- **Enhanced Logging**:
  - Detailed operation logging to timestamped log files
  - File download progress with byte counts
  - Error classification (auth issues, size mismatches, network errors)
  - Log files saved in export folder with matching timestamp

### Changed
- **File Download Reliability**: Complete rewrite of download system
  - Uses Slack API `files.info` to get fresh download URLs
  - Downloads entire file at once (no streaming) for better reliability
  - Validates content-type to detect HTML error pages
  - Tries alternate URLs if first attempt returns HTML
  - Increased timeout to 60 seconds for large files
  - Better size verification against expected file size

### Fixed
- File downloads now work correctly (was getting HTML error pages)
- File sizes now match expected sizes (was truncating to ~22%)
- Added `files:read` scope to documentation
- Config file now found correctly regardless of working directory

## [2.0.0] - 2025-01-15

### Added
- **Logging System**: Optional detailed logging to file with `ENABLE_LOGGING` setting
- **File Downloads**: Downloads file attachments using `requests` library
- **Markdown Export**: Optional `.md` formatted output with `CREATE_MARKDOWN` setting
- **Alphabetical Sorting**: Channels now display in alphabetical order
- **Smart File Skipping**: No longer creates empty files for channels with no messages in date range
- **Timestamp in Filenames**: Files now include time in YYYY-MM-DD-HHMM format
- **@ Symbol in Mentions**: User mentions now show as `[@anon01]` instead of `[anon01]`
- **Export Statistics**: Shows channels exported, total messages, and time elapsed
- **Pause at End**: Script waits for Enter key before closing (Windows convenience)
- **Better Error Handling**: Comprehensive logging of errors with stack traces
- **Progress Indicators**: Shows download progress and file counts
- **7-Day Filter Option**: Added 7-day option to date range filters

### Changed
- **Removed "TAK_USERS" from filenames**: Now uses generic "Slack-Export" naming
- **Improved User Mentions**: Better formatting in both text and markdown outputs
- **Enhanced Thread Display**: Better indentation and formatting for threaded conversations
- **File Download Method**: Switched from `urllib` to `requests` for better reliability
- **Anonymization**: More consistent handling of user IDs and mentions

### Fixed
- **Rate Limiting**: Better handling of Slack API rate limits with exponential backoff
- **Empty Channel Handling**: No longer creates files for channels with no messages
- **Unicode Handling**: Improved support for non-ASCII characters in messages

## [1.0.0] - 2025-01-XX (Original Version)

### Added
- Basic channel export functionality
- JSON and TXT output formats
- User anonymization with mapping key
- Date range filtering (30, 60, 90 days, or all)
- Thread support
- Reaction support
- Interactive channel selection
- Multiple channel export support

---

## Version History Summary

| Version | Date | Key Features |
|---------|------|--------------|
| 2.1.1 | 2025-10-22 | Filename sanitization fix, 100% download success |
| 2.1.0 | 2025-10-22 | Timestamped folders, config files, IP anonymization, reliable downloads |
| 2.0.0 | 2025-01-15 | Major rewrite: logging, file downloads, markdown export, smart features |
| 1.0.0 | 2025-01-XX | Initial release with basic export functionality |

---

## Upgrade Notes

### From 2.1.0 to 2.1.1
- No breaking changes
- Files with special characters in names will now download successfully
- No action required

### From 2.0.0 to 2.1.0
- **New folder structure**: Exports now go into timestamped subfolders
- **Config file recommended**: Create `config.json` from `config.example.json`
- **New scope required**: Add `files:read` scope to Slack app and reinstall
- Old exports remain in place; new exports use new structure

### From 1.0.0 to 2.0.0

**Breaking Changes:**
- Filename format changed from `YYYY-MM-DD-Slack-TAK_USERS-[channel]` to `YYYY-MM-DD-HHMM-Slack-Export-[channel]`
- File downloads now require `requests` library: `pip install requests`

**New Requirements:**
```bash
pip install --upgrade slack-sdk requests
```

**Configuration Changes:**
```python
# New settings available:
ENABLE_LOGGING = True      # Enable detailed logging
DOWNLOAD_FILES = False     # Enable file downloads (requires files:read scope)
CREATE_MARKDOWN = False    # Enable markdown export
```

**What Stays the Same:**
- Token configuration
- Channel selection process
- Output directory structure
- Anonymization key format
- JSON structure

---

## Planned Features

### Future Releases

- [ ] Configuration file support (JSON/YAML) âœ… **DONE in 2.1.0**
- [ ] Progress bars with `tqdm`
- [ ] Export to SQLite database
- [ ] Incremental exports (only new messages)
- [ ] Better HTML report generation
- [ ] Web-based UI (Flask/Streamlit)
- [ ] Search functionality across exports
- [ ] Export scheduling/automation
- [ ] Multiple workspace support
- [ ] Export encryption option
- [ ] IPv6 address anonymization
- [ ] Hostname/domain anonymization

---

## Contributing

See [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines on:
- Reporting bugs
- Suggesting features
- Submitting pull requests
- Code style guidelines

## Support

- **Issues**: https://github.com/mighkel/SLACK-BAK/issues
- **Discussions**: https://github.com/mighkel/SLACK-BAK/discussions

---

**Last Updated**: October 22, 2025  
**Current Version**: 2.1.1  
**Artifact Version**: v2 (Complete rollup through 2.1.1)
